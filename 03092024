Results Outline
Access Control: Database (3 issues)
Abstract
Without proper access control, executing a SQL statement that contains a user-controlled primary key can
allow an attacker to view unauthorized records.
Explanation
Database access control errors occur when: 1. Data enters a program from an untrusted source. 2. The
data is used to specify the value of a primary key in a SQL query. Example 1: The following code uses a
parameterized statement, which escapes metacharacters and prevents SQL injection vulnerabilities, to
construct and execute a SQL query that searches for an invoice matching the specified identifier [1]. The
identifier is selected from a list of all invoices associated with the current authenticated user.
...
id = Integer.decode(request.getParameter("invoiceID"));
String query = "SELECT * FROM invoices WHERE id = ?";
PreparedStatement stmt = conn.prepareStatement(query);
stmt.setInt(1, id);
ResultSet results = stmt.execute();
...
The problem is that the developer has failed to consider all of the possible values of id. Although the
interface generates a list of invoice identifiers that belong to the current user, an attacker might bypass this
interface to request any desired invoice. Because the code in this example does not check to ensure that
the user has permission to access the requested invoice, it will display any invoice, even if it does not
belong to the current user. Some think that in the mobile world, classic web application vulnerabilities, such
as database access control errors, do not make sense -- why would the user attack themself? However,
keep in mind that the essence of mobile platforms is applications that are downloaded from various sources
and run alongside each other on the same device. The likelihood of running a piece of malware next to a
banking application is high, which necessitates expanding the attack surface of mobile applications to
include inter-process communication. Example 2: The following code adapts Example 1 to the Android
platform.
...
 String id = this.getIntent().getExtras().getString("invoiceID");
 String query = "SELECT * FROM invoices WHERE id = ?";
 SQLiteDatabase db = this.openOrCreateDatabase("DB", MODE_PRIVATE,
null);
 Cursor c = db.rawQuery(query, new Object[]{id});
...
A number of modern web frameworks provide mechanisms to perform user input validation (including
Struts and Spring MVC). To highlight the unvalidated sources of input, Fortify Secure Coding Rulepacks
dynamically re-prioritize the issues Fortify Static Code Analyzer reports by lowering their probability of
exploit and providing pointers to the supporting evidence whenever the framework validation mechanism is
in use. We refer to this feature as Context-Sensitive Ranking. To further assist the Fortify user with the
auditing process, the Fortify Software Security Research group makes available the Data Validation project
template that groups the issues into folders based on the validation mechanism applied to their source of
input.
Recommendation
Rather than relying on the presentation layer to restrict values submitted by the user, access control should
be handled by the application and database layers. Under no circumstances should a user be allowed to
retrieve or modify a row in the database without the appropriate permissions. Every query that accesses
Sep 2, 2024, 5:00 PM
© Copyright [2008-2024] Micro Focus or one of its affiliates.
7
the database should enforce this policy, which can often be accomplished by simply including the current
authenticated username as part of the query. Example 3: The following code implements the same
functionality as Example 1 but imposes an additional constraint to verify that the invoice belongs to the
currently authenticated user.
...
userName = ctx.getAuthenticatedUserName();
id = Integer.decode(request.getParameter("invoiceID"));
String query =
 "SELECT * FROM invoices WHERE id = ? AND user = ?";
PreparedStatement stmt = conn.prepareStatement(query);
stmt.setInt(1, id);
stmt.setString(2, userName);
ResultSet results = stmt.execute();
...
And here is an Android equivalent:
...
 PasswordAuthentication pa = authenticator.getPasswordAuthentication();
 String userName = pa.getUserName();
 String id = this.getIntent().getExtras().getString("invoiceID");
 String query = "SELECT * FROM invoices WHERE id = ? AND user = ?";
 SQLiteDatabase db = this.openOrCreateDatabase("DB", MODE_PRIVATE,
null);
 Cursor c = db.rawQuery(query, new Object[]{id, userName});
...
Issue Summary
Engine Breakdown
SCA WebInspect SecurityScope Total
Access Control: Database 3 0 0 3
Total 3 0 0 3
Access Control: Database High
URL: null
TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/impl/
MigenqDetailsRepositoryImpl.java, line 192 (Access Control: Database) High
Issue Details
Kingdom: Security Features
Scan Engine: SCA (Data Flow)
Sep 2, 2024, 5:00 PM
© Copyright [2008-2024] Micro Focus or one of its affiliates.
8
Access Control: Database High
URL: null
TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/impl/
MigenqDetailsRepositoryImpl.java, line 192 (Access Control: Database) High
Source Details
Source: getCustomerDetails(0)
From: com.tcs.bancs.microservices.services.CHKDService.getCustomerDetails
File: TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/services/CHKDServi
ce.java:124
URL: null
121  @PostMapping(value = { "/CHKD" }, produces = { "application/json" })
122  @CrossOrigin()
123  @JsonIgnore
124  public String getCustomerDetails(@RequestBody(required = 
true)RequestBean reqbean,HttpServletRequest request, @RequestHeader 
HttpHeaders headers, HttpServletResponse response) throws SerialException, 
SQLException, IOException, RrnException, SrcException
125  {
126  try {
127  String[] arr = {bancsTraceState, masterDQType, bancsHost, fnsSysnum, 
ctrlSysnum, daySysnum, nightSysnum, non24hsum, defRMode, masterDB1, 
masterDB2, servicesFlag};
Sink Details
Sink: com.tcs.bancs.microservices.repository.ref.Migenq_t2DetailRefRepo.fetchData()
Enclosing Method: updateResponse()
File: TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/impl/
MigenqDetailsRepositoryImpl.java:192
Taint Flags: PRIMARY_KEY, WEB, XSS
189  }
190  }
191  else if (Logsaver == 2) {
192  Migenq_t2 fetchedRows = dayRepo2.fetchData(PK_REQ_REF_NO);
193  String authenticatedPkRef = fetchedRows.getMigpk().getPK_REQ_REF_NO();
194  int updatedRows = dayRepo2.updateResponse(RESPONSE_STATUS, ERROR_CODE, ERROR_DESCRIPTION, 
clob, RESP_STR, authenticatedPkRef);
195  if (updatedRows == 0) {
TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/impl/
MigenqDetailsRepositoryImpl.java, line 200 (Access Control: Database) High
Issue Details
Kingdom: Security Features
Scan Engine: SCA (Data Flow)
Source Details
Source: getCustomerDetails(0)
Sep 2, 2024, 5:00 PM
© Copyright [2008-2024] Micro Focus or one of its affiliates.
9
Access Control: Database High
URL: null
TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/impl/
MigenqDetailsRepositoryImpl.java, line 200 (Access Control: Database) High
From: com.tcs.bancs.microservices.services.CHKDService.getCustomerDetails
File: TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/services/CHKDServi
ce.java:124
URL: null
121  @PostMapping(value = { "/CHKD" }, produces = { "application/json" })
122  @CrossOrigin()
123  @JsonIgnore
124  public String getCustomerDetails(@RequestBody(required = 
true)RequestBean reqbean,HttpServletRequest request, @RequestHeader 
HttpHeaders headers, HttpServletResponse response) throws SerialException, 
SQLException, IOException, RrnException, SrcException
125  {
126  try {
127  String[] arr = {bancsTraceState, masterDQType, bancsHost, fnsSysnum, 
ctrlSysnum, daySysnum, nightSysnum, non24hsum, defRMode, masterDB1, 
masterDB2, servicesFlag};
Sink Details
Sink: com.tcs.bancs.microservices.repository.ref.Migenq_t3DetailRefRepo.fetchData()
Enclosing Method: updateResponse()
File: TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/impl/
MigenqDetailsRepositoryImpl.java:200
Taint Flags: PRIMARY_KEY, WEB, XSS
197  }
198  }
199  else if (Logsaver == 0) {
200  Migenq_t3 fetchedRows = dayRepo3.fetchData(PK_REQ_REF_NO);
201  String authenticatedPkRef = fetchedRows.getMigpk().getPK_REQ_REF_NO();
202  int updatedRows = dayRepo3.updateResponse(RESPONSE_STATUS, ERROR_CODE, ERROR_DESCRIPTION, 
clob, RESP_STR, authenticatedPkRef);
203  if (updatedRows == 0) {
TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/impl/
MigenqDetailsRepositoryImpl.java, line 184 (Access Control: Database) High
Issue Details
Kingdom: Security Features
Scan Engine: SCA (Data Flow)
Source Details
Source: getCustomerDetails(0)
From: com.tcs.bancs.microservices.services.CHKDService.getCustomerDetails
File: TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/services/CHKDServi
ce.java:124
Sep 2, 2024, 5:00 PM
© Copyright [2008-2024] Micro Focus or one of its affiliates.
10
Access Control: Database High
URL: null
TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/impl/
MigenqDetailsRepositoryImpl.java, line 184 (Access Control: Database) High
URL: null
121  @PostMapping(value = { "/CHKD" }, produces = { "application/json" })
122  @CrossOrigin()
123  @JsonIgnore
124  public String getCustomerDetails(@RequestBody(required = 
true)RequestBean reqbean,HttpServletRequest request, @RequestHeader 
HttpHeaders headers, HttpServletResponse response) throws SerialException, 
SQLException, IOException, RrnException, SrcException
125  {
126  try {
127  String[] arr = {bancsTraceState, masterDQType, bancsHost, fnsSysnum, 
ctrlSysnum, daySysnum, nightSysnum, non24hsum, defRMode, masterDB1, 
masterDB2, servicesFlag};
Sink Details
Sink: com.tcs.bancs.microservices.repository.ref.Migenq_t1DetailRefRepo.fetchData()
Enclosing Method: updateResponse()
File: TCSBaNCSQueryMicroservices/src/com/tcs/bancs/microservices/impl/
MigenqDetailsRepositoryImpl.java:184
Taint Flags: PRIMARY_KEY, WEB, XSS
181  int Logsaver = dayCount % 3;
182
183  if (Logsaver == 1) {
184  Migenq_t1 fetchedRows = dayRepo1.fetchData(PK_REQ_REF_NO);
185  String authenticatedPkRef = fetchedRows.getMigpk().getPK_REQ_REF_NO();
186  int updatedRows = dayRepo1.updateResponse(RESPONSE_STATUS, ERROR_CODE, ERROR_DESCRIPTION, 
clob, RESP_STR, authenticatedPkRef);
187  if (updatedRows == 0) {
